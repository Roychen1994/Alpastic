{% extends "websitebase.html" %}

{% block websitebody %}
<div class="page-header">
    <blockquote>
        <p class="lead">商品管理</p>
    </blockquote>
</div>

<ol class="breadcrumb">
  <li><a href="/website/adminproduct/">商品管理</a></li>
</ol>

<div class="panel panel-default">
  <div class="panel-body">
      <form class="form-inline" method="GET" role="form">
        <div class="form-group">
            {% csrf_token %}
            <label for="productclass" class="flable">商品类别</label>
            <select id="productclass" name="productclass" class="form-control">
                <option value="">全部</option>
                {% for cls in classes %}
                    <option value="{{ cls.id }}">{{ cls.CclassName }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="basic-pname" class="flable">商品名称</label>
            <input name="productname" id="basic-pname" type="text" class="form-control" aria-describedby="basic-pname" placeholder="请输入商品关键字...">
        </div>
        <button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search" aria-hidden="true"></span>&nbsp&nbsp搜索</button>
      </form>
  </div>
</div>


<div class="panel panel-default">
  <div class="panel-body">
      <div class="rightp" style="margin-bottom:8px;">
          <a type="button" class="btn btn-success" href="/website/adminproduct/add"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span>&nbsp&nbsp添加商品</a>
          <button data-toggle="modal" data-target="#delproductModal" type="button" class="btn btn-danger"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>&nbsp&nbsp删除所选</button>
      </div>
      <table class="table table-striped table-bordered">
          {% if product_list %}
          <thead>
            <tr>
                <td><input type="checkbox" id="allcb"></td>
                <td>商品ID</td>
                <td>类别</td>
                <td>商品名称</td>
                <td>创建时间</td>
            </tr>
          </thead>
            <tbody>
            {% for product in product_list %}
                <tr>
                    <td><input class="ncheck" type="checkbox" value="{{ product.id }}"></td>
                    <td>{{ product.id }}</td>
                    <td>{{ product.Commclass.CclassName }}</td>
                    <td class="productname"><a href="/website/adminproduct/{{ product.id }}">{{ product.CommName }}</a></td>
                    <td>{{ product.CreateTime }}</td>
                </tr>
          {% endfor %}
            </tbody>
          {% endif %}
      </table>
  </div>

        {% if product_list %}
          <nav class="mypagination" aria-label="Page navigation">
              <ul class="pagination">
                  {% if product_list.has_previous %}
                  <li>
                      <a href="?page={{ product_list.previous_page_number }}&productclass={{ productclassid }}&productname={{ productname }}" aria-label="Previous">
                          <span aria-hidden="true">&laquo;</span>
                      </a>
                  </li>
                  {% else %}
                  <li class="disabled">
                      <a class="disabled" href="#" aria-label="Previous">
                          <span aria-hidden="true">&laquo;</span>
                      </a>
                  </li>
                  {% endif %}
                  {% for p in pagelist %}
                  {% if p == product_list.number  %}
                  <li class="active" ><a href="#">{{ p }}</a></li>
                  {% else %}
                  <li><a href="?page={{ p }}&productclass={{ productclassid }}&productname={{ productname }}">{{ p }}</a></li>
                  {% endif %}
                  {% endfor %}
                  {% if product_list.has_next %}
                  <li>
                      <a href="?page={{ product_list.next_page_number }}&productclass={{ productclassid }}&productname={{ productname }}" aria-label="Next">
                          <span aria-hidden="true">&raquo;</span>
                      </a>
                  </li>
                  {% else %}
                  <li class="disabled">
                      <a class="disabled" href="#" aria-label="Next">
                          <span aria-hidden="true">&raquo;</span>
                      </a>
                  </li>
                  {% endif %}
              </ul>
          </nav>
    {% endif %}
</div>


<!----------------- 删除警告模态框 ------------------->
<div id="delproductModal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 id="delmodal_title" class="modal-title">删除</h4>
      </div>
      <div class="modal-body">
        <p class="text-danger">你确认要删除以下商品吗？<strong>其规格一起删除!</strong></p>
        <ol id="ol-delproductinfo">

        </ol>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
          <button id="btn_submitdel" type="button" class="btn btn-danger" onclick="jsdeleteproduct('del-product')">确认删除</button>
      </div>
	</div>
  </div>
</div>






<script>
$('#delproductModal').on('show.bs.modal', function (event) {
    var button = $(event.relatedTarget);
    var doms_checked = document.getElementsByClassName("ncheck");
    var prool = document.getElementById("ol-delproductinfo");
    prool.innerHTML = "";
    for(var i = doms_checked.length - 1; i >= 0; i--){
        if(doms_checked[i].checked){
            var lidom = document.createElement("li");
            var check_parent = doms_checked[i].parentNode.parentNode;
            var proname = check_parent.getElementsByClassName("productname")[0];
            lidom.innerText= proname.innerText;
            prool.append(lidom)
        }
    }
})

</script>


{% endblock %}


