{% extends "wxbase.html" %}

{% block mainbody %}

<div class="row">
	<form role="form" action="" method="get" class="search-form">
		<div class="col-lg-4 col-center-block">
		    <div class="input-group">
		    	<input name="search" type="text" class="form-control" placeholder="请输入搜索关键词">
				<span class="input-group-btn">
		        	<button class="btn btn-default" type="submit"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
		        </span>
		    </div><!-- /input-group -->
		</div>
	</form>
</div>

<h5><br></h5>

<div>
	{% csrf_token %}
	<ul class="nav nav-tabs nav-justified">
		{% if not this_cls %}
			<li class="active"><a href="/shop">全部</a></li>
				{% for commcls in classes %}
					<li><a href="?cls={{ commcls.id }}">{{ commcls.CclassName }}</a></li>
				{% endfor %}
		{% else %}
			<li><a href="/shop">全部</a></li>
			{% for commcls in classes %}
					{% if commcls.id == this_cls %}
						<li class="active"><a href="?cls={{ commcls.id }}">{{ commcls.CclassName }}</a></li>
					{% else %}
						<li><a href="?cls={{ commcls.id }}">{{ commcls.CclassName }}</a></li>
					{% endif %}
		    {% endfor %}
		{% endif %}
	</ul>
</div>

<div class="col-sm-10 col-sm-offset-1">
<table id="table-no-resize" >
		<thead>
			<tr>
				<th>类型</th>
				<th>名称</th>
				<th>厚度</th>
				<th>尺寸</th>
				<th>环保等级</th>
				<th>单位</th>
				<th>单价</th>
				<th>每件数量</th>
				<th>库存</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody>
		  {% for adetail in commodity_list %}
		  <tr>
			<td data-th="类型"><span class="bt-content"><div>{{ adetail.cls.CclassName }}</div></span></td>
			<td data-th="名称"><span class="bt-content"><a href="product/{{ adetail.detail.id }}"><strong>{{ adetail.info }}</strong></a></span></td>
			<td data-th="厚度"><span class="bt-content">{{ adetail.detail.Codthick }}</span></td>
			<td data-th="尺寸"><span class="bt-content">{{ adetail.detail.CodSize }}</span></td>
			<td data-th="环保等级"><span class="bt-content">{{ adetail.detail.Cod_Protlevel }}</span></td>
			<td data-th="单位"><span class="bt-content">{{ adetail.detail.CodUnit }}</span></td>
			<td data-th="单价"><span class="bt-content" style="color:indianred">￥{{ adetail.detail.CodunPrice }}</span></td>
			<td data-th="每件数量"><span class="bt-content">{{ adetail.detail.CodUnmun }}</span></td>
			<td data-th="库存"><span class="bt-content">{{ adetail.detail.Codinventory }}</span></td>
			<td data-th="操作"><span class="bt-content">
						<button data-toggle="modal" data-target="#buyModal" type="button" class="btn btn-primary" data-title="{{ adetail.info }}" data-price= "{{ adetail.detail.CodunPrice }}" data-dataid="{{ adetail.detail.id }}"
								data-thick="{{ adetail.detail.Codthick }}" data-codsize ="{{ adetail.detail.CodSize }}" data-protlevel="{{ adetail.detail.Cod_Protlevel }}" data-unit="{{ adetail.detail.CodUnit }}" data-Unum="{{ adetail.detail.CodUnmun }}"
								data-inventory="{{ adetail.detail.Codinventory }}" data-pimg="{{ adetail.info.Commimg|cut:"HdWxShop" }}">
							<span class="glyphicon glyphicon-shopping-cart" aria-hidden="true">加入购物车</span>
						</button>
						{% if  adetail.detail.id  in usercollect_list %}
						<button type="button" class="btn btn-success" dataid="{{ adetail.detail.id }}" onclick="ajax_addcollect(this,'del')" data-loading-text="Loading..."><span class="glyphicon glyphicon-star" aria-hidden="true"></span>已收藏</button>
						{% else %}
                        <button type="button" class="btn btn-warning" dataid="{{ adetail.detail.id }}" onclick="ajax_addcollect(this,'add')" data-loading-text="Loading..."><span class="glyphicon glyphicon-star-empty" aria-hidden="true"></span>收藏&nbsp&nbsp&nbsp&nbsp</button>
						{% endif %}
			</span></td>
		  </tr>
		  {% endfor %}

			</tbody>
		</table>

	{% if max_page != 0 %}
	<nav aria-label="Page navigation">
		<ul class="pagination">
			<li>
				<a href="?cls={{ this_cls }}&page={{ page_previous }}&search={{ search_value }}" aria-label="Previous">
					<span aria-hidden="true">&laquo;</span>
				</a>
			</li>
			{% for ipage in page_list %}
			<li><a href="?cls={{ this_cls }}&page={{ ipage }}&search={{ search_value }}">{{ ipage }}</a></li>
			{% endfor %}
			<li>
				<a href="?cls={{ this_cls }}&page={{ page_next }}&search={{ search_value }}" aria-label="Next">
					<span aria-hidden="true">&raquo;</span>
				</a>
			</li>
		</ul>
	</nav>
	{% endif %}
</div>


<!----------------- buyModal 模态框 ------------------->
<div class="modal fade" id="buyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">New message</h4>
      </div>
      <div class="modal-body">
		<div class="row">
			<div class="col-sm-5">
				<img id="modal-img" class="img-thumbnail" src="" style="width: 460px">
			</div>
			<div class="col-sm-7">
				<p id="p-uprice" class="price"></p>
                <p id="p-thick"></p>
                <p id="p-size"></p>
                <p id="p-protlevel"></p>
                <p id="p-nmun"></p>
				<form class="form-inline">
					<div class="form-group">
							<label for="productnum" class="control-label">购入数量:</label>
							<input type="text" class="form-control" id="productnum" value="1">
					</div>
				</form>
			</div>
		</div>
      <div class="modal-footer">
			<h3><small>合计:</small><strong id="h3-total" style="color:indianred"></strong></h3>
        	<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        	<button id="btn_addshoppingcart" type="button" dataid="" class="btn btn-primary" onclick="ajax_addshopingcart(this,'buy')">加入购物车</button>
      </div>
	 </div>
    </div>
  </div>
</div>



<div id="infomodal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 id="infomodal_title" class="modal-title"></h4>
      </div>
      <div class="modal-body">
        <p id="infomodal_message"></p>
      </div>
      <div class="modal-footer">
		<button type="button" class="btn btn-primary" onclick="window.location.href='/website/shoppingcart'">前往购物车</button>
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
      </div>
	</div>
  </div>
</div>


<script>
	$('#productnum').bind('input propertychange',total_buymodal);

	function total_buymodal(){
        try {
            var tprice = $("#unprice_value").text();
            var buynum = $('#productnum').val();
            document.getElementById('h3-total').innerHTML = buynum * tprice;
        }
        catch (err) {
            document.getElementById('h3-total').innerHTML = err
        }
    }
</script>

{% load static %}
<link href="{% static "shopstyle.css" %}" rel="stylesheet">
<script src="{% static "product.js" %}"></script>
{% endblock %}


