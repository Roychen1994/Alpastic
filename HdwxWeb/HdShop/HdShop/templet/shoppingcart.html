{% extends "personalbase.html" %}
{% block pbase %}

<div class="panel panel-default">
  <!-- Default panel contents -->
  <div class="panel-heading">您的购物车</div>
  <!-- Table -->
  <table class="table">
        {% csrf_token %}
        <tr>
            <td class="hidden-xs">图片</td>
            <td>商品名称</td>
            <td>规格</td>
            <td>数量</td>
            <td>总价格</td>
            <td>操作</td>
        </tr>
        {% for aproduct in shoppingcart %}
        <tr class="data_tr">
            <td class="hidden-xs"><img src="{{ aproduct.info.Commimg|cut:"HdWxShop" }}" alt="{{ aproduct.info.CommName }}" class="img-rounded md-image"></td>
            <td><a href="/shop/product/{{ aproduct.detail.id }}"><strong>{{ aproduct.info.CommName }}</strong></a></td>
            <td>
                        品牌：{{ aproduct.cart.Codbrand }}<br>
                        单价：￥{{ aproduct.cart.ScunPrice }}<br>
                        厚度：{{ aproduct.detail.Codthick }}<br>
                        尺寸：{{ aproduct.detail.CodSize }}<br>
                        环保等级：{{ aproduct.detail.Cod_Protlevel }}<br>
                        单件包装量：{{ aproduct.detail.CodUnmun }}{{ aproduct.detail.CodUnit }}<br>
            </td>
            <td><input class="num" name="num" unprice="{{ aproduct.cart.ScunPrice }}" type="text" value="{{ aproduct.cart.ScNum }}"></td>
            <td class="ths_total">￥{{ aproduct.cart.ScSum }}</td>
                <td><button scid="{{ aproduct.cart.id }}" type="button" class="btn btn-danger" onclick="ajax_addshopingcart(this,'del')">删除</button></td>
        </tr>
        {% endfor %}
  </table>
  <div class="panel-footer">
      <div class="row">
          <div class="col-sm-10 col-xs-6">
              <h3><small>合计:</small><strong class="unprice" id="total"></strong></h3>
          </div>
          <div class="col-sm-2 col-xs-6">
              <button id="uploadorder" type="button" class="btn btn-primary btn-lg" onclick="submitorder()"><span class="glyphicon glyphicon-shopping-cart" aria-hidden="true"></span>提交订单</button>
          </div>
      </div>
  </div>
</div>



<script>
    fresh_sum();
    $("input").bind('input propertychange',fresh_sum);

    function fresh_sum(){
    var alltotal = 0;
    var total_dom = document.getElementById('total');
    var tr_doms = document.getElementsByClassName('data_tr');
    for(var i=tr_doms.length-1;i>=0;i--){
        var tr_inputdom = tr_doms[i].getElementsByClassName('num')[0];
        var input_num = tr_inputdom.value;
        var input_unprice = tr_inputdom.getAttribute('unprice');
        var ths_total = input_num * input_unprice;
        tr_doms[i].getElementsByClassName('ths_total')[0].innerHTML = '￥' + String(ths_total);
        alltotal += ths_total
    }
        total_dom.innerHTML = '￥' + String(alltotal)
}
</script>


{% endblock %}

