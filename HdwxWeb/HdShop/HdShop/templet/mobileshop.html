{% extends "mobilebase.html" %}
{% block mobilebase %}
    {% load static %}
<select id="freshed" data-live-search="true" style="display: none">
    <option value="no" selected></option>
    <option id="freshedyes" value="yes"></option>
</select>

        <div class="row" id="mobileshop-main">
        <div class="mobile-indexhead">
            <img src="{% static "weblogo.png" %}">
        </div>
        <div class="mobile-search">
            <form id="form-inline searchform">
                {% csrf_token %}
                <div class="input-group col-xs-offset-1 col-xs-10">
                    {% if get_search %}
                        <input name="search" type="text" placeholder="关键词" value="{{ get_search }}" class="search-input form-control">
                    {% else %}
                        <input name="search" type="text" placeholder="关键词" value="" class="search-input form-control">
                    {% endif %}
                    <span class="input-group-btn">
                        <button type="button" id="btn_search" class="btn btn-default" onclick="get_productdata(1)"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
                        <button class="btn btn-default" type="button" onclick="window.location.href='/shop/'"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span></button>
                    </span>
                </div>
            </form>
            <hr/>
        </div>
        <div id="mobile-shopselect">
            <div class="chooserow">
                <span>类型</span>
                <div>
                    <ul id='ul-pcls' class="chooserowul">
                        <li class="active" value="" id="li-"><a>全部</a></li>
                        {% for commcls in classes %}
                            <li value="{{ commcls.id }}" id="li-{{ commcls.id }}"><a>{{ commcls.CclassName }}</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="chooserow">
                <span>功能</span>
                <div>
                    <ul id='ul-function' class="chooserowul">
                        <li class="active" value=""><a>全部</a></li>
                        {% for function in function_options %}
                            {% if function.Codfunction and function.Codfunction != "None" %}
                                <li value="{{ function.Codfunction }}"><a>{{ function.Codfunction }}</a></li>
                            {% endif %}
                        {% endfor %}
					</ul>
                </div>
            </div>
            <div class="chooserow">
                <span>品牌</span>
                <div>
                    <ul id='ul-brand' class="chooserowul">
                        <li class="active" value=""><a>全部</a></li>
                        {% for brank in brand_options %}
                            {% if brank.Codbrand and brank.Codbrand != "None" %}
                                    <li value="{{ brank.Codbrand }}"><a>{{ brank.Codbrand }}</a></li>
                            {% endif %}
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        <div id="mobile-otherselect">
            <div class="row">
                <div class="col-xs-4">
                    <div id="mobile-shopsort" class="col-xs-12">
                        <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span>价格排序&nbsp&nbsp</span><span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu">
                            <li id="unprice-sort" onclick="get_productdata('{{ details_Paginator.previous_page_number }}','{{ pcls }}','unprice','1')">
                                <a><span class="glyphicon glyphicon-sort-by-attributes" aria-hidden="true"></span>&nbsp&nbsp由低到高</a>
                            </li>
                            <li id="unprice-sorted" onclick="get_productdata('{{ details_Paginator.previous_page_number }}','{{ pcls }}','unprice','2')">
                                <a><span class="glyphicon glyphicon-sort-by-attributes-alt" aria-hidden="true"></span>&nbsp&nbsp由高到低</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div id="mobile-otherdiv" class="col-xs-4">
                    <a role="button" data-toggle="collapse" href="#mobile-otherhide" aria-expanded="false">
                        <span>其它选项&nbsp&nbsp</span><span class="glyphicon glyphicon-filter" aria-hidden="true"></span>
                    </a>
                </div>
                <div id="btn_select" class="col-xs-4 mobile-othersearch" onclick="get_productdata(1,'{{ pcls }}')">
                    <p>确认搜索&nbsp&nbsp<span class="glyphicon glyphicon-search" aria-hidden="true"></span></p>
                </div>
            </div>
        </div>

        <div id="mobile-otherhide"
            {% if thick or psize or protlevel %}
                class="collapse in"
            {% else %}
                class="collapse"
            {% endif %}
        >
            <div class="row hideselect-row">
                <div class="col-xs-3 hideselect-left">
                    <span>厚度</span>
                </div>
                <div class="col-xs-9 hideselect-right">
                    <select class="selectpicker" id="thick" name="thick" data-live-search="true">
                        <option value="">全部</option>
                        {% for athick in thick_options %}
                            {% if athick.Codthick == thick  %}
                                <option value="{{ athick.Codthick }}" selected="selected">{{ athick.Codthick }}</option>
                            {% else %}
                                <option value="{{ athick.Codthick }}">{{ athick.Codthick }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="row hideselect-row">
                <div class="col-xs-3 hideselect-left">
                    <span>尺寸</span>
                </div>
                <div class="col-xs-9 hideselect-right">
                    <select  class="selectpicker" id="psize" name="psize" data-live-search="true">
                        <option value="">全部</option>
                        {% for asize in size_options %}
                            {% if asize.CodSize == psize %}
                                <option value="{{ asize.CodSize }}" selected="selected">{{ asize.CodSize }}</option>
                            {% else %}
                                <option value="{{ asize.CodSize }}">{{ asize.CodSize }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-3 hideselect-left">
                    <span>环保等级</span>
                </div>
                <div class="col-xs-9 hideselect-right">
                    <select class="selectpicker" id="protlevel" name="protlevel" data-live-search="true">
                        <option value="">全部</option>
                        {% for aprotlevel in protlevel_options %}
                            {% if aprotlevel.Cod_Protlevel == protlevel %}
                                <option value="{{ aprotlevel.Cod_Protlevel }}" selected="selected">{{ aprotlevel.Cod_Protlevel }}</option>
                            {% else %}
                                <option value="{{ aprotlevel.Cod_Protlevel }}">{{ aprotlevel.Cod_Protlevel }}</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                </div>
            </div>
        </div>
        <div class="panel panel-default mtop">
            <div id="shopinfo" class="panel-body">

            </div>
        </div>
    </div>
<!----------------- buyModal 模态框 ------------------->
<div class="modal fade" id="buyModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="exampleModalLabel">New message</h4>
      </div>
      <div class="modal-body">
		<div class="row">
			<div class="col-sm-5 hidden-xs">
				<img id="modal-img" class="img-thumbnail" src="" style="width: 460px">
			</div>
			<div class="col-sm-7">
				<p id="p-uprice" class="price"></p>
                <p id="p-thick"></p>
                <p id="p-size"></p>
                <p id="p-protlevel"></p>
                <p id="p-nmun"></p>
				<form class="form-inline">
					<div class="form-group">
							<label for="productnum" class="control-label">购入数量:</label>
							<input type="text" class="form-control numinput" id="productnum" value="1">
					</div>
				</form>
			</div>
		</div>
        <div id="errorinfo" style="display:none;">

        </div>
      <div class="modal-footer">
          <div class="row">
              <div class="col-sm-4">
                  <p class="toatl-price"><small>合计:￥&nbsp&nbsp</small><strong id="h3-total" style="color:indianred"></strong></p>
              </div>
              <div class="col-sm-8">
                  <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                  <button id="btn_addshoppingcart" type="button" dataid="" class="btn btn-primary" onclick="ajax_addshopingcart(this,'buy')">加入购物车</button>
              </div>
          </div>
      </div>
	 </div>
    </div>
  </div>
</div>



<div id="infomodal" class="modal fade" tabindex="-1" role="dialog">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 id="infomodal_title" class="modal-title"></h4>
      </div>
      <div class="modal-body">
        <p id="infomodal_message"></p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
        <button type="button" class="btn btn-primary" onclick="window.location.href='/website/shoppingcart'">前往购物车</button>
      </div>
	</div>
  </div>
</div>


<script src="{% static "product.js" %}"></script>
<script>

    onload=function(){
		var refreshedselect=document.getElementById("freshed");
		var refreshedselect_index = refreshedselect.selectedIndex;
		var e = refreshedselect.options[refreshedselect_index];
		if(e.value==="no") {
		    var refreshedyes = document.getElementById('freshedyes');
		    refreshedyes.selected = true;
		    getshopinfocache();
		}
		else{
		    location.reload();
		}
		navfooteractive('nav-shopicon')
    };


	$('#productnum').bind('input propertychange',total_buymodal);

	function total_buymodal(){
        try {
            var tprice = $("#unprice_value").text();
            var buynum = $('#productnum').val();
            document.getElementById('h3-total').innerHTML = buynum * tprice;
        }
        catch (err) {
            document.getElementById('h3-total').innerHTML = err
        }
    }



$(".chooserowul li").click(function(event) {
    var li_siblings = $(this).siblings();
    li_siblings.removeClass('active');
    $(this).attr('class','active');

    var ul_pclsdom = document.getElementById('ul-pcls');
    var cls = ul_pclsdom.getElementsByClassName('active')[0].getAttribute('value');
    get_productdata(1,cls)
})



</script>

{% endblock %}